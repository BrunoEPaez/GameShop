#!/bin/bash
set -e

# Imprimir un mensaje para saber que el entrypoint se est치 ejecutando (ver치s esto en los logs)
echo "--- Iniciando el Entrypoint de Rails ---"

# Ejecuta las migraciones/preparaci칩n de la base de datos solo si estamos en producci칩n
# Esto es lo que reemplaza al "Pre-deploy command" que es de pago
if [ "$RAILS_ENV" = "production" ]; then
  echo "Ejecutando bin/rails db:prepare..."
  bundle exec rails db:prepare
fi

# El comando 'exec "$@"' hace que el contenedor ejecute el CMD del Dockerfile
# que en tu caso es: ./bin/thrust ./bin/rails server
echo "Lanzando el servidor..."
exec "$@"